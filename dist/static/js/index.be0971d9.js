(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["index"],{"0ae2":function(e,t,a){"use strict";var i=a("c1fc"),l=a.n(i);l.a},"175d":function(e,t,a){"use strict";var i=a("5344"),l=a.n(i);l.a},"3d43":function(e,t,a){},"3e51":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"changePwd"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-setting"}),e._v(" 系统管理\n            ")]),a("el-breadcrumb-item",[e._v("查询索引 - "+e._s(e.index.index))])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("div",{staticClass:"bill-top"},[a("el-button",{attrs:{type:"info"},on:{click:function(t){return e.doAddData()}}},[e._v("添加数据")]),a("el-button",{attrs:{title:"将搜索关键字作为文档ID来查询"},on:{click:function(t){return e.doQueryID()}}},[e._v("ID查询")]),a("el-button",{staticClass:"mr10",attrs:{icon:"el-icon-lx-refresh"},on:{click:function(t){return e.doRefresh()}}}),a("el-select",{staticClass:"wp mr10 w4",attrs:{multiple:"",clearable:"",filterable:"",placeholder:"选择字段"},model:{value:e.selectField,callback:function(t){e.selectField=t},expression:"selectField"}},e._l(e.fields,(function(t,i){return a("el-option",{key:"_opt_"+i,attrs:{label:""+t.name,value:t.name}},[a("span",[e._v(e._s(t.name))]),a("span",{staticClass:"desc"},[e._v(e._s(t.data.type))])])})),1),a("el-input",{staticClass:"w4 mr10",attrs:{placeholder:"输入关键字",clearable:""},model:{value:e.query.key,callback:function(t){e.$set(e.query,"key",t)},expression:"query.key"}}),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doQuery()}}},[e._v("查询")]),a("el-button",{staticClass:"mr10",attrs:{type:"success"},on:{click:function(t){return e.doQueryAll()}}},[e._v("全部数据")]),a("el-button",{attrs:{type:"danger",icon:"el-icon-lx-delete",title:"删除全部符合条件的数据"},on:{click:function(t){return e.doQuery(!0,!0)}}},[e._v("删除数据")]),a("el-button",{staticClass:"mr10",attrs:{type:"danger",icon:"el-icon-lx-delete"},on:{click:function(t){return e.doClearAll()}}},[e._v("清空数据")]),a("el-checkbox",{staticClass:"mr8 ml8",attrs:{label:"展开对象"},model:{value:e.query.expandedHeader,callback:function(t){e.$set(e.query,"expandedHeader",t)},expression:"query.expandedHeader"}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"hitsTable",staticClass:"table",attrs:{data:e.items,"render-header":e.labelHead,border:"",height:"calc(100vh - 350px)","header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{label:"操作",width:"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-lx-text"},on:{click:function(a){return a.stopPropagation(),e.doAddData(t.row)}}},[e._v("编辑")]),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return a.stopPropagation(),e.doDelete(t.$index,t.row)}}},[e._v("删除")])]}}])}),a("el-table-column",{attrs:{prop:"_type",label:"类型","min-width":"50"}}),a("el-table-column",{attrs:{prop:"_id",label:"ID","min-width":"80","class-name":"column-no-wrap"}}),a("el-table-column",{attrs:{prop:"_score",label:"分数","min-width":"50"}}),e._l(e.header,(function(t){return a("el-table-column",{key:t,attrs:{label:t,"class-name":"column-no-wrap"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("span",{domProps:{innerHTML:e._s(e.getColumnText(i.row._source,i.row.highlight,t))}})]}}],null,!0)})}))],2),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":e.query.pageindex,"page-sizes":[1,10,20,50,100,200,500],"page-size":e.query.pagesize,total:e.count},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange}})],1)],1)]),a("el-dialog",{attrs:{visible:e.edtAddDlgisible,title:e.index.index+" - "+(e.form.editmode?"编辑":"添加")+"数据",width:"68%","close-on-click-modal":!1},on:{"update:visible":function(t){e.edtAddDlgisible=t}}},[a("el-container",{staticStyle:{"max-height":"calc(100vh - 400px)"}},[a("el-main",[a("el-form",{ref:"index.add",attrs:{model:e.form}},[a("div",{staticStyle:{"margin-bottom":"8px"}},[a("div",{staticStyle:{"margin-bottom":"4px"}},[a("span",{staticClass:"title red"},[e._v("ID")])]),a("el-input",{attrs:{placeholder:"请输入自定义ID，留空则会自动生成"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),e._l(e.form.fields,(function(t,i){return a("div",{key:i,staticStyle:{"margin-bottom":"8px"}},[a("div",{style:"margin-bottom: 4px; margin-left:"+24*t.level+"px;"},[a("span",{staticClass:"title"},[e._v("\n                            "+e._s(e.getItemName(t,!0))+"\n                        ")]),t.data.properties?e._e():a("span",{staticClass:"desc mr10"},[a("span",{staticClass:"grey"},[e._v("数据类型：")]),e._v(e._s(t.data.type))]),t.data.properties?a("el-checkbox",{key:e.uuid(),staticClass:"ml10",attrs:{label:"数组",title:"将这个字段的值作为一个数组"},on:{change:function(a){return e.changeItemArrayState(t)}},model:{value:e.form.arrays[t.name],callback:function(a){e.$set(e.form.arrays,t.name,a)},expression:"form.arrays[item.name]"}}):e._e(),t.data.properties&&e.form.arrays[t.name]?a("el-input-number",{staticClass:"ml8 mr10",attrs:{title:"数组下标",step:1,min:0,max:e.getItemCount(t)},on:{change:function(a){return e.changeItemArrayIndex(t,a)}},model:{value:t.curItemIndex,callback:function(a){e.$set(t,"curItemIndex",a)},expression:"item.curItemIndex"}}):e._e(),t.data.properties&&e.form.arrays[t.name]?a("span",[e._v("共"+e._s(e.getItemCount(t))+"项")]):e._e()],1),t.data.properties?e._e():a("div",{style:"margin-left:"+24*t.level+"px"},[a("el-input",{attrs:{placeholder:"请输入值",clearable:""},model:{value:e.form.data[e.getItemName(t)],callback:function(a){e.$set(e.form.data,e.getItemName(t),a)},expression:"form.data[getItemName(item)]"}},[a("template",{slot:"append"},[a("el-checkbox",{key:e.uuid(),attrs:{label:"数组",title:"将这个字段的值作为一个数组"},model:{value:e.form.arrays[t.name],callback:function(a){e.$set(e.form.arrays,t.name,a)},expression:"form.arrays[item.name]"}})],1)],2)],1)])}))],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticStyle:{float:"left"}},[a("el-checkbox",{staticClass:"mr8 ml8",attrs:{label:"操作成功后关闭"},model:{value:e.form.closeDlg,callback:function(t){e.$set(e.form,"closeDlg",t)},expression:"form.closeDlg"}})],1),a("el-button",{on:{click:function(t){return e.doInsertData(1)}}},[e._v("查看请求语句")]),a("el-button",{on:{click:function(t){e.edtAddDlgisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doInsertData()}}},[e._v("确 定")])],1)],1)],1)},l=[],n=(a("456d"),a("7f7f"),a("6b54"),a("ac6a"),a("4917"),a("28a5"),a("cc46")),s=a("92e6"),r={name:"index",components:{field:n["a"],mappingClass:s["a"]},data:function(){return{loading:!1,query:{key:void 0,pageindex:1,pagesize:100,expandedHeader:!1},form:{data:{},arrays:{}},index:{},items:[],header:[],fields:[],selectField:[],count:0,lastCommand:void 0,lastApi:void 0,edtAddDlgisible:!1}},beforeRouteEnter:function(e,t,a){var i=e.query.index;e.params.title=i,a()},created:function(){this.index=this.$route.query},mounted:function(){this.loadFileds()},methods:{doRefresh:function(){this.loadFileds()},getColumnText:function(e,t,a){if(t&&t[a])return t[a][0];if(!e)return"";var i=a.indexOf(".");if(i<0)return e[a];for(var l=a.split("."),n=0;n<l.length;n++)if(e=e[l[n]],!e)return"";return e},loadFileds:function(){var e=this;this.$http.get("/"+this.index.index+"/_mappings").then((function(t){console.log(t);var a=t[e.index.index].mappings,i=[];e.initProperties(i,void 0,a.properties),e.fields=i,e.src=a,e.updateHeader()}))},initProperties:function(e,t,a,i,l,n){if(a)for(var s in a)if(s){var r=a[s];if(r.properties){var o=void 0;1==i&&(o={name:t?t+"."+s:s,key:s,data:r,level:l,parent:n},e.push(o)),this.initProperties(e,t?t+"."+s:s,r.properties,i,l+1,o)}else e.push({name:t?t+"."+s:s,key:s,data:r,level:l,parent:n})}},doQuery:function(e,t){var a=this;if(!e||this.query.key)if(1!=e||1!=t){var i={};if(this.query.key){var l=this.selectField;if(l&&l.length>0)1==l.length?(i.query={match:{}},e||(i.highlight={fields:{}}),i.query.match[l[0]]=this.query.key,e||(i.highlight.fields[l[0]]={})):(i.query={multi_match:{query:this.query.key,fields:[]}},e||(i.highlight={fields:{}}),l.forEach((function(t){i.query.multi_match.fields.push(t),e||(i.highlight.fields[t]={})})));else{var n=!isNaN(parseInt(this.query.key)),s=!isNaN(parseFloat(this.query.key)),r=Boolean(this.query.key).toString()==this.query.key,o=this.isDate(this.query.key)||this.isDateTime(this.query.key);i.query={multi_match:{query:this.query.key,fields:[]}},e||(i.highlight={fields:{}}),this.fields.forEach((function(t){if(0!=t.data.index){var a=t.data.type,l="string"==a||"text"==a||"keyword"==a;l||e||!n||(l="integer"==a||"long"==a||"short"==a||"byte"==a),l||e||!s||(l="double"==a||"float"==a||"half_float"==a||"scaled_float"==a),!l&&o&&(l="date"==a),!l&&r&&(l="boolean"==a),l&&(i.query.multi_match.fields.push(t.name),e||(i.highlight.fields[t.name]={}))}}))}}else i.query={match_all:{}};1==e?this.getData("/"+this.index.index+"/_delete_by_query",i,!0):this.getData("/"+this.index.index+"/_search",i)}else this.$confirm("是否确定删除此索引下所有符合当前查询条件的数据？","条件删除数据",{type:"warning",dangerouslyUseHTMLString:!0}).then((function(){a.doQuery(!0)})).catch((function(){}));else this.$message.info("条件删除必须输入查询关键字")},doQueryID:function(){var e=this;if(this.query.key){var t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$http.get("/"+this.index.index+"/_doc/"+this.query.key).then((function(a){e.count=1,e.items=[a],e.updateHeader(),e.loading=!1,t.close()})).catch((function(){e.loading=!1,t.close()}))}else this.$message.info("请输入查询关键字")},doQueryAll:function(){this.getData("/"+this.index.index+"/_search",{query:{match_all:{}}})},getData:function(e,t,a){var i=this,l=t||this.lastCommand,n=e||this.lastApi;if(l&&n){if(!a){var s=this.query.pageindex<1?1:this.query.pageindex,r=this.query.pagesize>0?this.query.pagesize:20;l.from=(s-1)*r,l.size=r,this.lastCommand=l,this.lastApi=n}this.loading=!0;var o=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$http.post(n,null,l).then((function(e){1==a?i.$message.info("成功删除了".concat(e.deleted,"条数据")):(i.count=e.hits.total.value,i.items=e.hits.hits,i.updateHeader()),i.loading=!1,o.close()})).catch((function(){i.loading=!1,o.close()}))}},updateHeader:function(){var e=this;this.header=[];var t=[];this.fields.forEach((function(a){var i=a.name.indexOf(".");if(i<0)t.push(a.name);else if(e.query.expandedHeader)t.push(a.name);else{var l=a.name.substr(0,i);t.indexOf(l)<0&&t.push(l)}})),this.header=t},labelHead:function(e,t){var a=t.column;t.index;return e("span",{class:"table-head",style:{width:"100%"}},[a.label])},handleSizeChange:function(e){this.$set(this.query,"pagesize",e),this.getData()},handlePageChange:function(e){this.$set(this.query,"pageindex",e),this.getData()},doDelete:function(e,t){var a=this;this.$http.post("/"+this.index.index+"/_delete_by_query",null,{query:{term:{_id:t._id}}}).then((function(t){a.$message.info("删除成功"),a.items.splice(e,1),a.count--}))},doClearAll:function(){var e=this;this.$confirm("是否确定清除此索引下所有数据？","清空数据",{type:"warning",dangerouslyUseHTMLString:!0}).then((function(){e.$http.post("/"+e.index.index+"/_delete_by_query",null,{query:{match_all:{}}}).then((function(t){e.$message.info("清除成功"),e.items=[],e.count=0}))})).catch((function(){}))},initFormData:function(e,t,a,i){if(e)if(a.data.properties){if(Array.isArray(e)){a.curItemIndex=0;var l=e.length;l<1&&(l=1),t.data[i+a.key+".count"]=l,t.arrays[a.name]=!0;for(var n=0;n<e.length;n++){var s=i+a.key+"["+n+"]";for(var r in a.data.properties)if(r){var o=this.findField(a.name+"."+r,t.fields);o&&this.initFormData(e[n][o.key],t,o,s+".")}}}else for(var r in a.data.properties)if(r){var d=this.findField(a.name+"."+r,t.fields);d&&this.initFormData(e[d.key],t,d,i+a.key+".")}}else{var c=i+a.key;t.data[c]=e instanceof Object?JSON.stringify(e):e}},doAddData:function(e){var t=this,a={data:{},arrays:{},fields:[],src:e,closeDlg:!1};this.initProperties(a.fields,void 0,this.src.properties,!0,0),null!=e?(a.fields.forEach((function(i){i&&0==i.level&&t.initFormData(e._source[i.name],a,i,"")})),a.id=e._id,a.closeDlg=!0,a.editmode=!0):a.fields.forEach((function(e){a.data[e.name]=e.data.null_value})),this.form=a,this.edtAddDlgisible=!0},changeItemArrayState:function(e){1==this.form.arrays[e.name]?(this.form.data[e.name]=[],e.curItemIndex=0,setItemCount(e,1)):(this.form.data[e.name]=void 0,e.curItemIndex=void 0,setItemCount(e,void 0))},changeItemArrayIndex:function(e,t){var a=this.getItemCountKey(e),i=this.form.data[a];void 0!=i&&null!=i||(i=1),t>=i&&(i++,this.form.data[a]=i),this.$forceUpdate()},getItemName:function(e,t){if(!e.parent)return e.name;var a=e.name.lastIndexOf(".");return a>0?1==this.form.arrays[e.parent.name]?(1==t?"":this.getItemName(e.parent))+"["+e.parent.curItemIndex+"]"+e.name.substr(a):(1==t?"":this.getItemName(e.parent))+e.name.substr(a):e.name},getItemCount:function(e){var t=this.form.data[this.getItemCountKey(e)];return void 0!=t&&null!=t||(t=1),t},setItemCount:function(e,t){this.form.data[this.getItemCountKey(e)]=t},getItemCountKey:function(e){return this.getItemName(e)+".count"},parseValueByType:function(e,t,a){if("object"==e)return JSON.parse(t);if(1==a){var i=JSON.parse(t);if(Array.isArray(i)){for(var l=0;l<i.length;l++)i[l]=this.parseValueByType(e,i[l]);return i}throw new Error('"'.concat(t," 不是一个数组"))}if("integer"==e||"long"==e||"short"==e||"byte"==e){var n=parseInt(t);if(isNaN(n))throw new Error('"'.concat(t," 不是一个整数"));return n}if("double"==e||"float"==e||"half_float"==e||"scaled_float"==e){var s=parseFloat(t);if(isNaN(s))throw new Error('"'.concat(t," 不是一个浮点数"));return s}if("boolean"==e){if("true"==t||"yes"==t||"1"==t)return!0;if("false"==t||"no"==t||"0"==t)return!1;throw new Error('"'.concat(t," 不是一个布尔值"))}return t},parseValue:function(e,t){if(t){var a=e.data;if(!a||!a.type)return t;var i=this.form.arrays[e.name];return this.parseValueByType(a.type,t,i)}},findField:function(e,t){for(var a=0;a<t.length;a++){var i=t[a];if(i&&i.name==e)return i}},setItemData:function(e,t,a){var i,l;if(a.data.properties){var n=this.getItemCount(a);if(1==this.form.arrays[a.name]&&void 0!=n&&n>0){e[a.key]=[];for(var s=0;s<n;s++){var r=t+a.key+"["+s+"]",o={};for(var d in a.data.properties)if(d){var c=this.findField(a.name+"."+d,this.form.fields);c&&this.setItemData(o,r+".",c)}Object.keys(o).length>0&&e[a.key].push(o)}}else{var u={};for(var d in a.data.properties)if(d){var f=this.findField(a.name+"."+d,this.form.fields);f&&this.setItemData(u,t+a.key+".",f)}Object.keys(u).length>0&&(e[a.key]=u)}}else{if(i=t+a.key,l=this.form.data[i],void 0==l)return;this.__key=i,this.__value=l,e[a.key]=this.parseValue(a,l)}},doInsertData:function(e){var t=this,a="/"+this.index.index+"/_doc/"+(this.form.id?this.form.id:""),i={};this.__key=void 0,this.__value=void 0;try{console.log("make data");for(var l=0;l<this.form.fields.length;l++){var n=this.form.fields[l];n&&0==n.level&&this.setItemData(i,"",n)}}catch(r){return void this.$message({type:"error",dangerouslyUseHTMLString:!0,message:"解析字段 <b>".concat(this.__key,"</b> 的值时发生异常:<br><br>").concat(this.__value,"<br><br><b>异常描述:</b> ")+r})}if(1!=e){var s=this.$loading({lock:!0,text:"Saveing",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$http.post(a,null,i).then((function(e){s.close();var a=t.form.src?"修改成功":"添加成功";t.form.closeDlg?(t.edtAddDlgisible=!1,t.$message.info(a+"，请重新查询查看结果")):(t.form.id=void 0,t.form.src=void 0,t.form.editmode=void 0,t.$message.info(a))})).catch((function(){return s.close()}))}else this.$alert('<el-container style="max-height: calc(100vh - 400px); "><el-main><pre style="height: 60vh; overflow: scroll;">'+(this.form.id?"更新数据":"插入数据")+"\n\nPOST "+config.sServiceHost+a+"\n\n"+JSON.stringify(i,null,2)+"</pre></el-main></el-container>","请求数据",{dangerouslyUseHTMLString:!0}).then((function(){}))}}},o=r,d=(a("e7b6"),a("0ae2"),a("2877")),c=Object(d["a"])(o,i,l,!1,null,"65913036",null);t["default"]=c.exports},5344:function(e,t,a){},5984:function(e,t,a){},"78af":function(e,t,a){},"8e6f":function(e,t,a){"use strict";var i=a("3d43"),l=a.n(i);l.a},"92e6":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"w3 wp mr10",attrs:{clearable:"",placeholder:e.placeholder},model:{value:e.cls.dynamic,callback:function(t){e.$set(e.cls,"dynamic",t)},expression:"cls.dynamic"}},e._l(e.dynamicTypes,(function(t,i){return a("el-option",{key:i,attrs:{label:""+t.value,value:t.value}},[a("span",[e._v(e._s(t.name))])])})),1)},l=[],n={name:"mappingClass",data:function(){return{cls:{},dynamicTypes:[{name:"true (默认值，动态添加字段)",value:!0},{name:"false (忽略新字段)",value:!1},{name:"strict (陌生字段抛出异常)",value:"strict"}]}},props:{mapClass:{type:Object,required:!0},placeholder:{type:String,default:"点击选择"}},created:function(){},mounted:function(){this.cls=this.mapClass,"true"==this.cls.dynamic?this.cls.dynamic=!0:"false"==this.cls.dynamic&&(this.cls.dynamic=!1)},computed:{},methods:{}},s=n,r=(a("8e6f"),a("2877")),o=Object(r["a"])(s,i,l,!1,null,"13b17fe0",null);t["a"]=o.exports},"9a38":function(e,t,a){"use strict";var i=a("5984"),l=a.n(i);l.a},c1fc:function(e,t,a){},cc46:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[void 0!=e.fieldData.items&&e.fieldData.items.length>0?a("div",e._l(e.fieldData.items,(function(t,i){return a("div",{key:t.id},[a("field-item",{style:"margin-left:"+24*t.level+"px;",attrs:{field:t},on:{onDelete:e.doDeleteItem,onAddChild:e.doAddChildItem,onShowCode:e.doShowFieldCode}})],1)})),0):e._e(),a("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(t){return e.doAddField()}}},[e._v("添加")]),a("el-dialog",{attrs:{visible:e.edtFieldCodeVisible,title:"属性  "+e.curField.name,width:"75%","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.edtFieldCodeVisible=t}}},[a("el-input",{attrs:{readonly:e.curField.old,type:"textarea",rows:20,placeholder:"请输入内容"},model:{value:e.curFieldCode,callback:function(t){e.curFieldCode=t},expression:"curFieldCode"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.edtFieldCodeVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{disabled:e.curField.old},on:{click:function(t){return e.doSaveFieldCode()}}},[e._v("确 定")])],1)],1)],1)},l=[],n=(a("7f7f"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"field-item",staticStyle:{"margin-bottom":"4px"}},[a("el-input",{staticClass:"w1 mr10 wp",attrs:{placeholder:"属性名称",disabled:e.field.old},model:{value:e.fieldData.name,callback:function(t){e.$set(e.fieldData,"name",t)},expression:"fieldData.name"}}),a("el-select",{staticClass:"w4 wp mr10",attrs:{clearable:"",disabled:e.field.old||void 0!=e.fieldData.data.properties,title:"属性类型",placeholder:"属性类型"},on:{change:e.onDataTypeChange},model:{value:e.fieldData.data.type,callback:function(t){e.$set(e.fieldData.data,"type",t)},expression:"fieldData.data.type"}},e._l(e.fieldTypes,(function(t,i){return a("el-option",{key:"_opt_"+i,attrs:{label:""+t.value,value:t.value}},[a("span",[e._v(e._s(t.value))]),a("span",{staticClass:"select-desc"},[e._v(e._s(t.name))])])})),1),e.fieldData.data.properties?a("mapping-class",{attrs:{mapClass:e.fieldData.data}}):e._e(),e.fieldData.data.properties||"string"==e.fieldData.data.type||"text"==e.fieldData.data.type?e._e():a("el-input",{staticClass:"w2 mr10 wp",attrs:{placeholder:"默认值"},on:{input:e.setNullValue},model:{value:e.null_value,callback:function(t){e.null_value=t},expression:"null_value"}}),e.fieldData.data.properties?e._e():a("el-input",{staticClass:"w5 mr10 wp",attrs:{placeholder:"加权",title:"字段级别索引分数加权，浮点数值，默认1.0"},model:{value:e.fieldData.data.boost,callback:function(t){e.$set(e.fieldData.data,"boost",t)},expression:"fieldData.data.boost"}}),e.fieldData.data.properties||"scaled_float"!=e.fieldData.data.type?e._e():a("el-input",{staticClass:"w2 mr10 wp",attrs:{disabled:e.field.old,title:"比例因子",placeholder:"比例因子"},model:{value:e.fieldData.data.scaling_factor,callback:function(t){e.$set(e.fieldData.data,"scaling_factor",t)},expression:"fieldData.data.scaling_factor"}}),e.fieldData.data.properties||"date"!=e.fieldData.data.type?e._e():a("el-input",{staticClass:"w3 mr10 wp",attrs:{clearable:"",placeholder:"格式"},model:{value:e.fieldData.data.format,callback:function(t){e.$set(e.fieldData.data,"format",t)},expression:"fieldData.data.format"}}),e.fieldData.data.properties?e._e():a("el-select",{staticClass:"w3 wp mr10",attrs:{clearable:"",title:"默认 not_analyzed",placeholder:"索引状态"},on:{change:e.onIndexTypeChange},model:{value:e.fieldData.data.index,callback:function(t){e.$set(e.fieldData.data,"index",t)},expression:"fieldData.data.index"}},e._l(e.indexStatus,(function(t,i){return a("el-option",{key:"_opt_"+i,attrs:{label:""+t.value,value:t.value}},[a("span",[e._v(e._s(t.value))]),a("span",{staticClass:"select-desc"},[e._v(e._s(t.name))])])})),1),e.fieldData.data.properties||"string"!=e.fieldData.data.type&&"text"!=e.fieldData.data.type&&"keyword"!=e.fieldData.data.type?e._e():a("el-select",{staticClass:"w3 wp mr10",attrs:{clearable:"",title:void 0==e.fieldData.data.index||e.fieldData.data.index?"默认 positions":"默认 docs",placeholder:"索引选项"},model:{value:e.fieldData.data.index_options,callback:function(t){e.$set(e.fieldData.data,"index_options",t)},expression:"fieldData.data.index_options"}},e._l(e.indexOptions,(function(t,i){return a("el-option",{key:"_opt_"+i,attrs:{label:""+t.value,value:t.value}},[a("span",[e._v(e._s(t.value))]),a("span",{staticClass:"select-desc"},[e._v(e._s(t.name))])])})),1),e.fieldData.data.properties?e._e():a("el-checkbox",{staticClass:"mr8",attrs:{label:"排序聚合",title:"支持排序和聚合",disabled:e.field.old,checked:void 0==e.fieldData.data.doc_values||e.fieldData.data.doc_values},model:{value:e.fieldData.data.doc_values,callback:function(t){e.$set(e.fieldData.data,"doc_values",t)},expression:"fieldData.data.doc_values"}}),a("el-button",{attrs:{icon:"el-icon-setting",size:"mini",type:"text",title:"查看或编辑代码"},on:{click:function(t){return e.doViewCode()}}}),e.field.old?e._e():a("el-button",{attrs:{icon:"el-icon-close",size:"mini",type:"text",title:"删除属性"},on:{click:function(t){return e.doDeleteField()}}}),!e.field.old||e.fieldData.data.properties?a("el-button",{attrs:{icon:"el-icon-plus",size:"mini",type:"text",title:"添加子属性"},on:{click:function(t){return e.doAddField()}}}):e._e()],1)}),s=[],r=a("92e6"),o={name:"fieldItem",components:{mappingClass:r["a"]},data:function(){return{null_value:void 0,fieldData:{data:{}},fieldTypes:[{name:"字符串（需要全文检索时使用）",value:"text"},{name:"字符串（精确值搜索）",value:"keyword"},{name:"布尔值（true 或 false）",value:"boolean"},{name:"整数（32位有符号）",value:"integer"},{name:"整数（64位有符号）",value:"long"},{name:"整数（-32768~32767）",value:"short"},{name:"整数（-128~127）",value:"byte"},{name:"浮点数（64位）",value:"double"},{name:"浮点数（32位）",value:"float"},{name:"浮点数（16位）",value:"half_float"},{name:"浮点数（缩放类型）",value:"scaled_float"},{name:"日期类型",value:"date"},{name:"范围类型",value:"range"},{name:"二进制数据（默认只存储不索引）",value:"binary"},{name:"JSON对象",value:"object"},{name:"嵌套类",value:"nested"},{name:"地理坐标",value:"geo_point"},{name:"地理地图",value:"geo_shape"},{name:"IPv4或IPv6地址",value:"ip"},{name:"范围类型",value:"completion"},{name:"附件类型",value:"attachment"},{name:"抽取类型",value:"percolator"}],indexStatus:[{name:"无索引，不可查询",value:!1},{name:"有索引（默认）",value:!0}],indexOptions:[{name:"索引文档号",value:"docs"},{name:"文档号+词频",value:"freqs"},{name:"文档号+词频+位置，通常用来距离查询",value:"positions"},{name:"文档号+词频+位置+偏移量，通常被使用在高亮字段",value:"offsets"}]}},props:{field:{type:Object,required:!0}},created:function(){},computed:{},mounted:function(){this.fieldData=this.field,this.null_value=this.getNullValue()},methods:{doDeleteField:function(){this.$emit("onDelete",this.field)},doAddField:function(){this.$emit("onAddChild",this.field),this.$forceUpdate()},doViewCode:function(){this.$emit("onShowCode",this.field)},onDataTypeChange:function(e){this.setNullValue(this.null_value,e),this.null_value=this.getNullValue(),"date"!=e&&delete this.fieldData.data["format"],"scaled_float"!=e&&delete this.fieldData.data["scaling_factor"]},onIndexTypeChange:function(e){this.index=void 0==e||""==e?void 0:"true"===e},getNullValue:function(){var e=this.fieldData.data.null_value;return void 0!=e&&(e+=""),e},setNullValue:function(e,t){var a;if(void 0!=e&&""!==e){var i=void 0==t?this.fieldData.data.type:t;if("integer"==i||"long"==i||"short"==i||"byte"==i)a=parseInt(e),isNaN(a)&&(a=void 0);else if("double"==i||"float"==i||"half_float"==i||"scaled_float"==i)a=parseFloat(e),isNaN(a)&&(a=void 0);else if("boolean"==i)a="true"==e||"yes"==e||!0===e;else if("object"==i||"array"==i)if(e)try{a=JSON.parse(e)}catch(l){a=void 0}else a=void 0;else a=e}this.fieldData.data.null_value=a}}},d=o,c=(a("175d"),a("2877")),u=Object(c["a"])(d,n,s,!1,null,"147e8e6b",null),f=u.exports,m={name:"field",components:{fieldItem:f},data:function(){return{cls:{data:{},name:void 0},curField:{},edtFieldCodeVisible:!1,curFieldCode:void 0}},props:{fieldData:{type:Object,required:!0}},created:function(){},computed:{},mounted:function(){},methods:{doShowFieldCode:function(e){this.curField=e,this.curFieldCode=JSON.stringify(e.data,null,2),this.edtFieldCodeVisible=!0},doSaveFieldCode:function(){try{var e=JSON.parse(this.curFieldCode);void 0==e&&(e={}),this.curField.data=e,this.curField={},this.edtFieldCodeVisible=!1}catch(t){this.$message.error("代码错误："+t)}},doAddField:function(){this.$emit("onAddChange",this.fieldData,{name:this.cls.name,type:this.cls.data.type,format:this.cls.data.format,scaled_float:this.cls.data.scaled_float,index:this.cls.data.index,enabled:!0}),this.cls.name=void 0,this.$forceUpdate()},doDeleteItem:function(e){var t=this.getParentItem(e);if(!(t.index<0)){console.log(t),t.count<=1&&t.parent&&(t.parent.data={});for(var a=1,i=t.index+1;i<this.fieldData.items.length;i++){var l=this.fieldData.items[i];if(!(l.level>e.level))break;a++}this.fieldData.items.splice(t.index,a),this.$forceUpdate()}},doAddChildItem:function(e){var t=this.fieldData.items.indexOf(e);if(!(t<0)){e.data={properties:{}};var a=this.getNextItemIndex(t);this.$emit("onAddChange",this.fieldData,{name:void 0,type:void 0,level:e.level+1,enabled:!0},a<0?t+1:a),this.$forceUpdate()}},getNextItemIndex:function(e){for(var t=this.fieldData.items[e].level,a=e+1;a<this.fieldData.items.length;a++)if(this.fieldData.items[a].level==t)return a;return-1},getParentItem:function(e){for(var t,a=this.fieldData.items,i=0,l=-1,n=-1,s=0;s<a.length;s++)if(a[s]==e){if(n=s,0==e.level)l=0;else for(var r=s;r>=0;r--)if(a[r].level<e.level){t=a[r],l=r;break}break}for(var o=l+1;o<a.length;o++){var d=a[o].level;if(d==e.level)i++;else if(d<e.level)break}return{count:i,parent:t,index:n}}}},h=m,p=(a("9a38"),Object(c["a"])(h,i,l,!1,null,"736bbd03",null));t["a"]=p.exports},e7b6:function(e,t,a){"use strict";var i=a("78af"),l=a.n(i);l.a}}]);